<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="og:url" content="https://missing-semesters-ruet.github.io/2020/security/" />
  <meta property="og:site_name" content="The Missing Semesters of Your CS" />

   
  <meta name="twitter:title" content="Security and Cryptography" />
  <meta property="og:title" content="Security and Cryptography" />

  

  <title>
      Security and Cryptography &middot; The Missing Semesters of Your CS  
  </title>

  <link rel="stylesheet" href="/static/css/main.css" />
  <link rel="stylesheet" href="/static/css/syntax.css" />
  <link rel="stylesheet" href="/static/css/note.css" />
  <link
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic&subset=latin,latin-ext"
    rel="stylesheet"
    type="text/css"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900&subset=latin,latin-ext"
    rel="stylesheet"
    type="text/css"
  />

  <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=G-P7WVHD84D1"
  ></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-P7WVHD84D1");
  </script>
</head>


  <body>

    <div id="nav-bg">
  <nav id="top-nav">
    <a href="/" id="logo">./missing-semester</a>
    <input type="checkbox" id="menu-icon" />
    <label class="menu-label" for="menu-icon"></label>
    <div class="trigger">
      <div class="trigger-child">
        <span class="nav-link"><a href="/2025/">lectures</a></span>
        <span class="nav-link">
          <a href="/statement_of_intent">statement of intent</a>
        </span>
        <span class="nav-link"><a href="/about/">about</a></span>
      </div>
    </div>
  </nav>
</div>


    <div id="content">
    <h1 class="title">Security and Cryptography</h1>


  <div class="youtube-wrapper" style="padding-bottom: 56.25%;">
    <iframe src="https://www.youtube.com/embed/tjwobAmnKTo" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  </div>


<p>Last year’s <a href="/2019/security/">security and privacy lecture</a> focused on how you
can be more secure as a computer <em>user</em>. This year, we will focus on security
and cryptography concepts that are relevant in understanding tools covered
earlier in this class, such as the use of hash functions in Git or key
derivation functions and symmetric/asymmetric cryptosystems in SSH.</p>

<p>This lecture is not a substitute for a more rigorous and complete course on
computer systems security (<a href="https://css.csail.mit.edu/6.858/">6.858</a>) or
cryptography (<a href="https://courses.csail.mit.edu/6.857/">6.857</a> and 6.875). Don’t
do security work without formal training in security. Unless you’re an expert,
don’t <a href="https://www.schneier.com/blog/archives/2015/05/amateurs_produc.html">roll your own
crypto</a>.
The same principle applies to systems security.</p>

<p>This lecture has a very informal (but we think practical) treatment of basic
cryptography concepts. This lecture won’t be enough to teach you how to
<em>design</em> secure systems or cryptographic protocols, but we hope it will be
enough to give you a general understanding of the programs and protocols you
already use.</p>

<h1 id="entropy">Entropy</h1>

<p><a href="https://en.wikipedia.org/wiki/Entropy_(information_theory)">Entropy</a> is a
measure of randomness. This is useful, for example, when determining the
strength of a password.</p>

<p><img src="https://imgs.xkcd.com/comics/password_strength.png" alt="XKCD 936: Password Strength" /></p>

<p>As the above <a href="https://xkcd.com/936/">XKCD comic</a> illustrates, a password like
“correcthorsebatterystaple” is more secure than one like “Tr0ub4dor&amp;3”. But how
do you quantify something like this?</p>

<p>Entropy is measured in <em>bits</em>, and when selecting uniformly at random from a
set of possible outcomes, the entropy is equal to <code class="language-plaintext highlighter-rouge">log_2(# of possibilities)</code>.
A fair coin flip gives 1 bit of entropy. A dice roll (of a 6-sided die) has
~2.58 bits of entropy.</p>

<p>You should consider that the attacker knows the <em>model</em> of the password, but
not the randomness (e.g. from <a href="https://en.wikipedia.org/wiki/Diceware">dice
rolls</a>) used to select a particular
password.</p>

<p>How many bits of entropy is enough? It depends on your threat model. For online
guessing, as the XKCD comic points out, ~40 bits of entropy is pretty good. To
be resistant to offline guessing, a stronger password would be necessary (e.g.
80 bits, or more).</p>

<h1 id="hash-functions">Hash functions</h1>

<p>A <a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">cryptographic hash
function</a> maps data
of arbitrary size to a fixed size, and has some special properties. A rough
specification of a hash function is as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hash(value: array&lt;byte&gt;) -&gt; vector&lt;byte, N&gt;  (for some fixed N)
</code></pre></div></div>

<p>An example of a hash function is <a href="https://en.wikipedia.org/wiki/SHA-1">SHA1</a>,
which is used in Git. It maps arbitrary-sized inputs to 160-bit outputs (which
can be represented as 40 hexadecimal characters). We can try out the SHA1 hash
on an input using the <code class="language-plaintext highlighter-rouge">sha1sum</code> command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">printf</span> <span class="s1">'hello'</span> | <span class="nb">sha1sum</span>
<span class="go">aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d
</span><span class="gp">$</span><span class="w"> </span><span class="nb">printf</span> <span class="s1">'hello'</span> | <span class="nb">sha1sum</span>
<span class="go">aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d
</span><span class="gp">$</span><span class="w"> </span><span class="nb">printf</span> <span class="s1">'Hello'</span> | <span class="nb">sha1sum</span> 
<span class="go">f7ff9e8b7bb2e09b70935a5d785e0cc5d9d0abf0
</span></code></pre></div></div>

<p>At a high level, a hash function can be thought of as a hard-to-invert
random-looking (but deterministic) function (and this is the <a href="https://en.wikipedia.org/wiki/Random_oracle">ideal model of a
hash function</a>). A hash function
has the following properties:</p>

<ul>
  <li>Deterministic: the same input always generates the same output.</li>
  <li>Non-invertible: it is hard to find an input <code class="language-plaintext highlighter-rouge">m</code> such that <code class="language-plaintext highlighter-rouge">hash(m) = h</code> for
some desired output <code class="language-plaintext highlighter-rouge">h</code>.</li>
  <li>Target collision resistant: given an input <code class="language-plaintext highlighter-rouge">m_1</code>, it’s hard to find a
different input <code class="language-plaintext highlighter-rouge">m_2</code> such that <code class="language-plaintext highlighter-rouge">hash(m_1) = hash(m_2)</code>.</li>
  <li>Collision resistant: it’s hard to find two inputs <code class="language-plaintext highlighter-rouge">m_1</code> and <code class="language-plaintext highlighter-rouge">m_2</code> such that
<code class="language-plaintext highlighter-rouge">hash(m_1) = hash(m_2)</code> (note that this is a strictly stronger property than
target collision resistance).</li>
</ul>

<p>Note: while it may work for certain purposes, SHA-1 is <a href="https://shattered.io/">no
longer</a> considered a strong cryptographic hash function.
You might find this table of <a href="https://valerieaurora.org/hash.html">lifetimes of cryptographic hash
functions</a> interesting. However, note that
recommending specific hash functions is beyond the scope of this lecture. If you
are doing work where this matters, you need formal training in
security/cryptography.</p>

<h2 id="applications">Applications</h2>

<ul>
  <li>Git, for content-addressed storage. The idea of a <a href="https://en.wikipedia.org/wiki/Hash_function">hash
function</a> is a more general
concept (there are non-cryptographic hash functions). Why does Git use a
cryptographic hash function?</li>
  <li>A short summary of the contents of a file. Software can often be downloaded
from (potentially less trustworthy) mirrors, e.g. Linux ISOs, and it would be
nice to not have to trust them. The official sites usually post hashes
alongside the download links (that point to third-party mirrors), so that the
hash can be checked after downloading a file.</li>
  <li><a href="https://en.wikipedia.org/wiki/Commitment_scheme">Commitment schemes</a>.
Suppose you want to commit to a particular value, but reveal the value itself
later. For example, I want to do a fair coin toss “in my head”, without a
trusted shared coin that two parties can see. I could choose a value <code class="language-plaintext highlighter-rouge">r =
random()</code>, and then share <code class="language-plaintext highlighter-rouge">h = sha256(r)</code>. Then, you could call heads or tails
(we’ll agree that even <code class="language-plaintext highlighter-rouge">r</code> means heads, and odd <code class="language-plaintext highlighter-rouge">r</code> means tails). After you
call, I can reveal my value <code class="language-plaintext highlighter-rouge">r</code>, and you can confirm that I haven’t cheated by
checking <code class="language-plaintext highlighter-rouge">sha256(r)</code> matches the hash I shared earlier.</li>
</ul>

<h1 id="key-derivation-functions">Key derivation functions</h1>

<p>A related concept to cryptographic hashes, <a href="https://en.wikipedia.org/wiki/Key_derivation_function">key derivation
functions</a> (KDFs) are
used for a number of applications, including producing fixed-length output for
use as keys in other cryptographic algorithms. Usually, KDFs are deliberately
slow, in order to slow down offline brute-force attacks.</p>

<h2 id="applications-1">Applications</h2>

<ul>
  <li>Producing keys from passphrases for use in other cryptographic algorithms
(e.g. symmetric cryptography, see below).</li>
  <li>Storing login credentials. Storing plaintext passwords is bad; the right
approach is to generate and store a random
<a href="https://en.wikipedia.org/wiki/Salt_(cryptography)">salt</a> <code class="language-plaintext highlighter-rouge">salt = random()</code> for
each user, store <code class="language-plaintext highlighter-rouge">KDF(password + salt)</code>, and verify login attempts by
re-computing the KDF given the entered password and the stored salt.</li>
</ul>

<h1 id="symmetric-cryptography">Symmetric cryptography</h1>

<p>Hiding message contents is probably the first concept you think about when you
think about cryptography. Symmetric cryptography accomplishes this with the
following set of functionality:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>keygen() -&gt; key  (this function is randomized)

encrypt(plaintext: array&lt;byte&gt;, key) -&gt; array&lt;byte&gt;  (the ciphertext)
decrypt(ciphertext: array&lt;byte&gt;, key) -&gt; array&lt;byte&gt;  (the plaintext)
</code></pre></div></div>

<p>The encrypt function has the property that given the output (ciphertext), it’s
hard to determine the input (plaintext) without the key. The decrypt function
has the obvious correctness property, that <code class="language-plaintext highlighter-rouge">decrypt(encrypt(m, k), k) = m</code>.</p>

<p>An example of a symmetric cryptosystem in wide use today is
<a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a>.</p>

<h2 id="applications-2">Applications</h2>

<ul>
  <li>Encrypting files for storage in an untrusted cloud service. This can be
combined with KDFs, so you can encrypt a file with a passphrase. Generate <code class="language-plaintext highlighter-rouge">key
= KDF(passphrase)</code>, and then store <code class="language-plaintext highlighter-rouge">encrypt(file, key)</code>.</li>
</ul>

<h1 id="asymmetric-cryptography">Asymmetric cryptography</h1>

<p>The term “asymmetric” refers to there being two keys, with two different roles.
A private key, as its name implies, is meant to be kept private, while the
public key can be publicly shared and it won’t affect security (unlike sharing
the key in a symmetric cryptosystem). Asymmetric cryptosystems provide the
following set of functionality, to encrypt/decrypt and to sign/verify:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>keygen() -&gt; (public key, private key)  (this function is randomized)

encrypt(plaintext: array&lt;byte&gt;, public key) -&gt; array&lt;byte&gt;  (the ciphertext)
decrypt(ciphertext: array&lt;byte&gt;, private key) -&gt; array&lt;byte&gt;  (the plaintext)

sign(message: array&lt;byte&gt;, private key) -&gt; array&lt;byte&gt;  (the signature)
verify(message: array&lt;byte&gt;, signature: array&lt;byte&gt;, public key) -&gt; bool  (whether or not the signature is valid)
</code></pre></div></div>

<p>The encrypt/decrypt functions have properties similar to their analogs from
symmetric cryptosystems. A message can be encrypted using the <em>public</em> key.
Given the output (ciphertext), it’s hard to determine the input (plaintext)
without the <em>private</em> key. The decrypt function has the obvious correctness
property, that <code class="language-plaintext highlighter-rouge">decrypt(encrypt(m, public key), private key) = m</code>.</p>

<p>Symmetric and asymmetric encryption can be compared to physical locks. A
symmetric cryptosystem is like a door lock: anyone with the key can lock and
unlock it. Asymmetric encryption is like a padlock with a key. You could give
the unlocked lock to someone (the public key), they could put a message in a
box and then put the lock on, and after that, only you could open the lock
because you kept the key (the private key).</p>

<p>The sign/verify functions have the same properties that you would hope physical
signatures would have, in that it’s hard to forge a signature. No matter the
message, without the <em>private</em> key, it’s hard to produce a signature such that
<code class="language-plaintext highlighter-rouge">verify(message, signature, public key)</code> returns true. And of course, the
verify function has the obvious correctness property that <code class="language-plaintext highlighter-rouge">verify(message,
sign(message, private key), public key) = true</code>.</p>

<h2 id="applications-3">Applications</h2>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Pretty_Good_Privacy">PGP email encryption</a>.
People can have their public keys posted online (e.g. in a PGP keyserver, or on
<a href="https://keybase.io/">Keybase</a>). Anyone can send them encrypted email.</li>
  <li>Private messaging. Apps like <a href="https://signal.org/">Signal</a> and
<a href="https://keybase.io/">Keybase</a> use asymmetric keys to establish private
communication channels.</li>
  <li>Signing software. Git can have GPG-signed commits and tags. With a posted
public key, anyone can verify the authenticity of downloaded software.</li>
</ul>

<h2 id="key-distribution">Key distribution</h2>

<p>Asymmetric-key cryptography is wonderful, but it has a big challenge of
distributing public keys / mapping public keys to real-world identities. There
are many solutions to this problem. Signal has one simple solution: trust on
first use, and support out-of-band public key exchange (you verify your
friends’ “safety numbers” in person). PGP has a different solution, which is
<a href="https://en.wikipedia.org/wiki/Web_of_trust">web of trust</a>. Keybase has yet
another solution of <a href="https://keybase.io/blog/chat-apps-softer-than-tofu">social
proof</a> (along with other
neat ideas). Each model has its merits; we (the instructors) like Keybase’s
model.</p>

<h1 id="case-studies">Case studies</h1>

<h2 id="password-managers">Password managers</h2>

<p>This is an essential tool that everyone should try to use (e.g.
<a href="https://keepassxc.org/">KeePassXC</a>, <a href="https://git.zx2c4.com/password-store/about/">pass</a>,
and <a href="https://1password.com">1Password</a>). Password managers make it convenient to use unique,
randomly generated high-entropy passwords for all your logins, and they save
all your passwords in one place, encrypted with a symmetric cipher with a key
produced from a passphrase using a KDF.</p>

<p>Using a password manager lets you avoid password reuse (so you’re less impacted
when websites get compromised), use high-entropy passwords (so you’re less likely to
get compromised), and only need to remember a single high-entropy password.</p>

<h2 id="two-factor-authentication">Two-factor authentication</h2>

<p><a href="https://en.wikipedia.org/wiki/Multi-factor_authentication">Two-factor
authentication</a>
(2FA) requires you to use a passphrase (“something you know”) along with a 2FA
authenticator (like a <a href="https://www.yubico.com/">YubiKey</a>, “something you have”)
in order to protect against stolen passwords and
<a href="https://en.wikipedia.org/wiki/Phishing">phishing</a> attacks.</p>

<h2 id="full-disk-encryption">Full disk encryption</h2>

<p>Keeping your laptop’s entire disk encrypted is an easy way to protect your data
in the case that your laptop is stolen. You can use <a href="https://wiki.archlinux.org/index.php/Dm-crypt/Encrypting_a_non-root_file_system">cryptsetup +
LUKS</a>
on Linux,
<a href="https://fossbytes.com/enable-full-disk-encryption-windows-10/">BitLocker</a> on
Windows, or <a href="https://support.apple.com/en-us/HT204837">FileVault</a> on macOS.
This encrypts the entire disk with a symmetric cipher, with a key protected by
a passphrase.</p>

<h2 id="private-messaging">Private messaging</h2>

<p>Use <a href="https://signal.org/">Signal</a> or <a href="https://keybase.io/">Keybase</a>. End-to-end
security is bootstrapped from asymmetric-key encryption. Obtaining your
contacts’ public keys is the critical step here. If you want good security, you
need to authenticate public keys out-of-band (with Signal or Keybase), or trust
social proofs (with Keybase).</p>

<h2 id="ssh">SSH</h2>

<p>We’ve covered the use of SSH and SSH keys in an <a href="/2020/command-line/#remote-machines">earlier
lecture</a>. Let’s look at the cryptography
aspects of this.</p>

<p>When you run <code class="language-plaintext highlighter-rouge">ssh-keygen</code>, it generates an asymmetric key pair, <code class="language-plaintext highlighter-rouge">public_key,
private_key</code>. This is generated randomly, using entropy provided by the
operating system (collected from hardware events, etc.). The public key is
stored as-is (it’s public, so keeping it a secret is not important), but at
rest, the private key should be encrypted on disk. The <code class="language-plaintext highlighter-rouge">ssh-keygen</code> program
prompts the user for a passphrase, and this is fed through a key derivation
function to produce a key, which is then used to encrypt the private key with a
symmetric cipher.</p>

<p>In use, once the server knows the client’s public key (stored in the
<code class="language-plaintext highlighter-rouge">.ssh/authorized_keys</code> file), a connecting client can prove its identity using
asymmetric signatures. This is done through
<a href="https://en.wikipedia.org/wiki/Challenge%E2%80%93response_authentication">challenge-response</a>.
At a high level, the server picks a random number and sends it to the client.
The client then signs this message and sends the signature back to the server,
which checks the signature against the public key on record. This effectively
proves that the client is in possession of the private key corresponding to the
public key that’s in the server’s <code class="language-plaintext highlighter-rouge">.ssh/authorized_keys</code> file, so the server
can allow the client to log in.</p>

<h1 id="resources">Resources</h1>

<ul>
  <li><a href="/2019/security/">Last year’s notes</a>: from when this lecture was more focused on security and privacy as a computer user</li>
  <li><a href="https://latacora.micro.blog/2018/04/03/cryptographic-right-answers.html">Cryptographic Right Answers</a>: answers “what crypto should I use for X?” for many common X.</li>
</ul>

<h1 id="exercises">Exercises</h1>

<ol>
  <li><strong>Entropy.</strong>
    <ol>
      <li>Suppose a password is chosen as a concatenation of four lower-case
dictionary words, where each word is selected uniformly at random from a
dictionary of size 100,000. An example of such a password is
<code class="language-plaintext highlighter-rouge">correcthorsebatterystaple</code>. How many bits of entropy does this have?</li>
      <li>Consider an alternative scheme where a password is chosen as a sequence
of 8 random alphanumeric characters (including both lower-case and
upper-case letters). An example is <code class="language-plaintext highlighter-rouge">rg8Ql34g</code>. How many bits of entropy
does this have?</li>
      <li>Which is the stronger password?</li>
      <li>Suppose an attacker can try guessing 10,000 passwords per second. On
average, how long will it take to break each of the passwords?</li>
    </ol>
  </li>
  <li><strong>Cryptographic hash functions.</strong> Download a Debian image from a
<a href="https://www.debian.org/CD/http-ftp/">mirror</a> (e.g. <a href="http://debian.xfree.com.ar/debian-cd/current/amd64/iso-cd/">from this Argentinean
mirror</a>).
Cross-check the hash (e.g. using the <code class="language-plaintext highlighter-rouge">sha256sum</code> command) with the hash
retrieved from the official Debian site (e.g. <a href="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA256SUMS">this
file</a>
hosted at <code class="language-plaintext highlighter-rouge">debian.org</code>, if you’ve downloaded the linked file from the
Argentinean mirror).</li>
  <li><strong>Symmetric cryptography.</strong> Encrypt a file with AES encryption, using
<a href="https://www.openssl.org/">OpenSSL</a>: <code class="language-plaintext highlighter-rouge">openssl aes-256-cbc -salt -in {input
filename} -out {output filename}</code>. Look at the contents using <code class="language-plaintext highlighter-rouge">cat</code> or
<code class="language-plaintext highlighter-rouge">hexdump</code>. Decrypt it with <code class="language-plaintext highlighter-rouge">openssl aes-256-cbc -d -in {input filename} -out
{output filename}</code> and confirm that the contents match the original using
<code class="language-plaintext highlighter-rouge">cmp</code>.</li>
  <li><strong>Asymmetric cryptography.</strong>
    <ol>
      <li>Set up <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2">SSH
keys</a>
on a computer you have access to (not Athena, because Kerberos interacts
weirdly with SSH keys). Make sure
your private key is encrypted with a passphrase, so it is protected at
rest.</li>
      <li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-gpg-to-encrypt-and-sign-messages">Set up GPG</a></li>
      <li>Send Anish an encrypted email (<a href="https://keybase.io/anish">public key</a>).</li>
      <li>Sign a Git commit with <code class="language-plaintext highlighter-rouge">git commit -S</code> or create a signed Git tag with
<code class="language-plaintext highlighter-rouge">git tag -s</code>. Verify the signature on the commit with <code class="language-plaintext highlighter-rouge">git show
--show-signature</code> or on the tag with <code class="language-plaintext highlighter-rouge">git tag -v</code>.</li>
    </ol>
  </li>
</ol>


<hr>

<div class="small center">
<p><a href="https://github.com/missing-semester/missing-semester/blob/master/_2020/security.md">Edit this page</a>.</p>
<p>Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA</a>.</p>
</div>

    </div>

  </body>

</html>
